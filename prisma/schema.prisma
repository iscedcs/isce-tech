generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id             String      @id @default(uuid())
  name           String
  description    String?
  price          Float
  deviceType     DeviceType
  images         String[]
  features       String[]
  stock          Int
  isCustomizable Boolean     @default(false)
  color          String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  orderItems     OrderItem[]
}

model Order {
  id            String        @id @default(uuid())
  userId        String
  totalAmount   Float
  vatAmount     Float
  deliveryPrice Float
  deviceType    DeviceType
  status        OrderStatus   @default(PENDING)
  transactionId String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  orderItems    OrderItem[]
  shippingInfo  ShippingInfo?
}

model OrderItem {
  id               String   @id @default(uuid())
  orderId          String
  productId        String
  quantity         Int
  unitPrice        Float
  customizationFee Float?
  designServiceFee Float?
  cardColor        String?
  frontDesignUrl   String?
  backDesignUrl    String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  order            Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product          Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model PendingOrder {
  id        String   @id @default(cuid())
  reference String   @unique
  data      Json
  createdAt DateTime @default(now())
}

model ShippingInfo {
  id             String   @id @default(uuid())
  orderId        String   @unique
  userId         String
  firstName      String
  lastName       String
  email          String
  phone          String
  address        String
  city           String
  state          String
  deliveryMethod String
  pickupLocation String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  order          Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

enum OrderStatus {
  PENDING_PAYMENT
  PAID
  PENDING
  FAILED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum DeviceType {
  CARD
  WRISTBAND
  STICKER
  KEYCHAIN
}
